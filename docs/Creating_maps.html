<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Creating Thematic Maps â€“ The Python Companion to Spatial Cluster Analysis with GeoDa</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Multivariate_local.html" rel="next">
<link href="./introduction.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Creating_maps.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Creating Thematic Maps</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The Python Companion to Spatial Cluster Analysis with GeoDa</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Creating_maps.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Creating Thematic Maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Multivariate_local.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Multivariate Local Spatial Clusters</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Density_cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Density Based Clustering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Principal Component Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MDS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Distance Preserving Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hierarchical_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hierarchical Clustering Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kmeans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Partitioning Clustering Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kmedoids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Clustering Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spectral_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Spectral Clustering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatializing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Spatializing Classic Clustering Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hierarchical_spatial_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatially Constrained Clustering - Hierarchical Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./partitioned_spatial_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Spatially Constrained Clustering - Partitioning Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cluster_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Cluster Validation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bibliography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link active" data-scroll-target="#preliminaries"><span class="header-section-number">2.1</span> Preliminaries</a>
  <ul class="collapse">
  <li><a href="#import-required-modules" id="toc-import-required-modules" class="nav-link" data-scroll-target="#import-required-modules"><span class="header-section-number">2.1.1</span> Import Required Modules</a></li>
  <li><a href="#sec-loaddata" id="toc-sec-loaddata" class="nav-link" data-scroll-target="#sec-loaddata"><span class="header-section-number">2.1.2</span> Load Data</a></li>
  </ul></li>
  <li><a href="#polygon-maps" id="toc-polygon-maps" class="nav-link" data-scroll-target="#polygon-maps"><span class="header-section-number">2.2</span> Polygon Maps</a>
  <ul class="collapse">
  <li><a href="#matplotlib-logic" id="toc-matplotlib-logic" class="nav-link" data-scroll-target="#matplotlib-logic"><span class="header-section-number">2.2.1</span> Matplotlib Logic</a></li>
  </ul></li>
  <li><a href="#map-design-characteristics" id="toc-map-design-characteristics" class="nav-link" data-scroll-target="#map-design-characteristics"><span class="header-section-number">2.3</span> Map Design Characteristics</a>
  <ul class="collapse">
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification"><span class="header-section-number">2.3.1</span> Classification</a></li>
  <li><a href="#sec-colormap" id="toc-sec-colormap" class="nav-link" data-scroll-target="#sec-colormap"><span class="header-section-number">2.3.2</span> Color Map</a></li>
  <li><a href="#areal-outlines" id="toc-areal-outlines" class="nav-link" data-scroll-target="#areal-outlines"><span class="header-section-number">2.3.3</span> Areal Outlines</a></li>
  <li><a href="#saving-the-map-to-a-file" id="toc-saving-the-map-to-a-file" class="nav-link" data-scroll-target="#saving-the-map-to-a-file"><span class="header-section-number">2.3.4</span> Saving the Map to a File</a></li>
  </ul></li>
  <li><a href="#mapping-polygon-boundaries" id="toc-mapping-polygon-boundaries" class="nav-link" data-scroll-target="#mapping-polygon-boundaries"><span class="header-section-number">2.4</span> Mapping Polygon Boundaries</a></li>
  <li><a href="#mapping-point-data" id="toc-mapping-point-data" class="nav-link" data-scroll-target="#mapping-point-data"><span class="header-section-number">2.5</span> Mapping Point Data</a>
  <ul class="collapse">
  <li><a href="#points-with-polygons" id="toc-points-with-polygons" class="nav-link" data-scroll-target="#points-with-polygons"><span class="header-section-number">2.5.1</span> Points with Polygons</a></li>
  </ul></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">2.6</span> Practice</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-maps" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Creating Thematic Maps</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this Chapter, we briefly introduce functionality to create thematic maps with Python. This provides only a subset of the mapping capabilities in <code>GeoDa</code> (e.g., as illustrated in Chapters 4 to 6 of the <em>GeoDa Explore Book</em>), but it is sufficient to provide basic visualization for the examples considered in this companion.</p>
<p>There are many ways to create beautiful maps in Python, for example, using packages such as <code>folium</code> or <code>plotly</code>. Here, the <code>plot</code> functionality of <code>geopandas</code> is introduced, which is sufficient for most of our purposes. The functionality will be illustrated with the <strong>chicago_commpop</strong> and <strong>liquor</strong> sample data sets. In contrast to what is the case in the other chapters, the examples do not have a direct counterpart in the GeoDa books, since they are focused on the functionality in <code>geopandas</code>.</p>
<p>As packages, we will need <code>matplotlib.pyplot</code> and <code>spatial-cluster-helper</code> in addition to <code>geopandas</code>. Note that in the actual <code>import</code> statement used in the code, the relevant module is <code>spatial_cluster_helper</code> (underlines, <em>not</em> dashes).</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Required Packages">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Required Packages
</div>
</div>
<div class="callout-body-container callout-body">
<p>geopandas, matplotlib.pyplot, spatial-cluster-helper</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Required Data Sets">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Required Data Sets
</div>
</div>
<div class="callout-body-container callout-body">
<p>chicago_commpop, liquor</p>
</div>
</div>
<section id="preliminaries" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">2.1</span> Preliminaries</h2>
<section id="import-required-modules" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="import-required-modules"><span class="header-section-number">2.1.1</span> Import Required Modules</h3>
<p>Following standard practice, we import <code>geopandas</code> as <code>gpd</code> and <code>matplotlib.pyplot</code> as <code>plt</code>. In addition, we also use the <code>ensure_datasets</code> function from the <code>spatial_cluster_helper</code> module to load the data.</p>
<div id="e49b893f" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spatial_cluster_helper <span class="im">import</span> ensure_datasets</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-loaddata" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="sec-loaddata"><span class="header-section-number">2.1.2</span> Load Data</h3>
<p>To illustrate the examples, we assume that the data sets are in a <code>./datasets/</code> subdirectory of the main directory from which the code is executed. Alternatively, the <code>path</code> variable can be customized.</p>
<p>Before the data are read using the <code>read_file</code> command from <code>geopandas</code>, <code>ensure_datasets</code> is invoked with <code>"chicago_commpop/chicago_commpop.shp"</code> as the path for the shape file. If the files are not present in the designated <code>path</code> folder, they are downloaded and installed. If they are already present, nothing happens. In the examples below and in the other chapters, the sample data are installed in the proper directory so no downloading is illustrated.</p>
<p>Next, the input files are read into the GeoDataFrame <code>chi_comm</code>. The data set contains nine variables for the 77 community areas of Chicago. We will focus on the variable that gives the percentage change in population between 2010 and 2020, <code>POPPERCH</code>.</p>
<p>The same process is applied to the liquor store locations data set that is used to illustrate point maps. After <code>ensure_datasets</code> is invoked with <code>"liquor/liq_Chicago.shp"</code> as the shape file, the data are loaded in the GeoDataFrame <code>point_df</code>.</p>
<p>As is our customary approach, we specify all the files and variables in one place, so that it is easy to run the same set of commands for different data sets and/or variables. We load the data and provide a quick check of the contents.</p>
<div id="ff9d54dc" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting working folder:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#path = "/your/path/to/data/"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">"./datasets/"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the Chicago community area data:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>shpfile1 <span class="op">=</span> <span class="st">"chicago_commpop/chicago_commpop.shp"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the Chicago liquor store data:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>shpfile2 <span class="op">=</span> <span class="st">"liquor/liq_Chicago.shp"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the datasets:</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>ensure_datasets(shpfile1, folder_path <span class="op">=</span> path)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>chi_comm <span class="op">=</span> gpd.read_file(path <span class="op">+</span> shpfile1)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(chi_comm.shape)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(chi_comm.head(<span class="dv">3</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>ensure_datasets(shpfile2, folder_path <span class="op">=</span> path)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>point_df <span class="op">=</span> gpd.read_file(path <span class="op">+</span> shpfile2)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(point_df.shape)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(point_df.head(<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(77, 9)
     community  NID  POP2010  POP2000  POPCH   POPPERCH  popplus  popneg  \
0      DOUGLAS   35    18238    26470  -8232 -31.099358        0       1   
1      OAKLAND   36     5918     6110   -192  -3.142390        0       1   
2  FULLER PARK   37     2876     3420   -544 -15.906433        0       1   

                                            geometry  
0  POLYGON ((-87.60914 41.84469, -87.60915 41.844...  
1  POLYGON ((-87.59215 41.81693, -87.59231 41.816...  
2  POLYGON ((-87.6288 41.80189, -87.62879 41.8017...   

(571, 3)
   id                      placeid                                geometry
0   0  ChIJnyLZdBTSD4gRbsa_hRGgPtc   MULTIPOINT ((1161395.91 1928443.285))
1   3  ChIJ5Vdx0AssDogRVjbNIyF3Mr4  MULTIPOINT ((1178227.792 1881864.522))
2   4  ChIJb5I6QwYsDogRe8R4E9K8mkk  MULTIPOINT ((1178151.911 1879212.002))</code></pre>
</div>
</div>
<p>For the polygon layers, the variable of interest is given as <code>plotvar</code>, which is set to <code>POPPERCH</code>. The point layer does not have a variable since just the location of the liquor stores is of interest.</p>
<div id="83630493" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>plotvar <span class="op">=</span> <span class="st">'POPPERCH'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="polygon-maps" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="polygon-maps"><span class="header-section-number">2.2</span> Polygon Maps</h2>
<p>Once the data is loaded as a GeoDataFrame, a basic plot function can be called from the object to show the polygons obtained from the shapefile:</p>
<div id="cell-fig-basic-plot" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>chi_comm.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-basic-plot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-basic-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-basic-plot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basic-plot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: Basic map as a plot
</figcaption>
</figure>
</div>
</div>
</div>
<p>We can use any variable contained in the GeoDataFrame to create a choropleth map. Before delving into customization, the default choropleth map created by the <code>plot</code> function is illustrated. A bare bones implementation only requires the variable to be mapped (the argument <code>column</code>) and the argument <code>legend = True</code>. Without the latter, there will still be a map, but it will not have a legend, so there will be no guide as to what the colors mean. In the example, we will use the percentage population change, <code>POPPERCH</code>, contained in the just-created place-holder variable <code>plotvar</code>.</p>
<p>Note that population totals should be avoided in thematic maps. Any total such as population or housing units is a so-called <em>spatially extensive variable</em>. All else being the same, one would expect the values for such variables to be larger in larger areas, and thereby provide a false sense of importance. Instead, one should always aim to map <em>spatially intensive variables</em>, such as densities, percentages, per capita values, etc. Hence, we use percentage population change in the example instead of total population.</p>
<div id="cell-fig-basic-map" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>chi_comm.plot(column <span class="op">=</span> plotvar, legend <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-basic-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-basic-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-basic-map-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basic-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: Choropleth map as a basic plot with legend
</figcaption>
</figure>
</div>
</div>
</div>
<section id="matplotlib-logic" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="matplotlib-logic"><span class="header-section-number">2.2.1</span> Matplotlib Logic</h3>
<p>The <code>matplotlib</code> library is extremely powerful and allows just about any type of customized visualization. It starts by setting up the basic parameters and then builds a graphic representation layer by layer. The terminology may seem a bit strange at first, but after a while, it becomes more familiar.</p>
<p>A plot is initialized by assigning some parameters to the tuple <code>fig , ax</code>. It is important to realize that <code>fig</code> is about the figure makeup and <code>ax</code> is about the actual plots. For example, <code>fig</code> is used to specify how many subplots there need to be, how they are arranged and what their size is. Since the examples used here and in later Chapters will mostly produce a single plot, the <code>fig</code> aspect can generally be ignored, and only <code>ax</code> is needed. In fact, for simple plots such as the maps in our applications, the specification of <code>ax</code> as such is not totally necessary and the <code>plot</code> function can be applied directly to the GeoDataFrame. However, in general, it remains good practice to refer to the plot object as <code>ax</code> in order to allow many further customizations.</p>
<p>An alternative way to set up the default map just shown is to explicitly assign it to an object <code>ax</code>, as <code>ax = chi_comm.plot()</code> with the same arguments as before. To remove the x-y coordinates and box around the map, the method <code>set_axis_off()</code> is applied to the <code>ax</code> object. Using this setup also removes any <code>&lt;Axes: &gt;</code> listing at the top of the graph. Otherwise, everything is still the same as before.</p>
<div id="cell-fig-basic-noaxes" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(column <span class="op">=</span> plotvar, legend <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-basic-noaxes" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-basic-noaxes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-basic-noaxes-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basic-noaxes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: Choropleth map without axes
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="map-design-characteristics" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="map-design-characteristics"><span class="header-section-number">2.3</span> Map Design Characteristics</h2>
<p>The purpose of a choropleth or thematic map is to visualize the spatial distribution of a variable over areal units. Choropleth comes from the Greek choros, which stands for region, so it is a map for regions. For our purposes, the proper design of a map has three important characteristics, which each translate into arguments to the <code>plot</code> function:</p>
<ul>
<li><p>classification</p></li>
<li><p>color</p></li>
<li><p>legend</p></li>
</ul>
<section id="classification" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="classification"><span class="header-section-number">2.3.1</span> Classification</h3>
<p>Arguably the most important characteristic is the classification used, i.e., how the continuous distribution of a given variable gets translated into a small number of discrete categories, or bins. This is exactly the same issue as encountered in the design of histogram bins.</p>
<p>The assignment of observations to distinct bins is done by the <code>mapclassify</code> library, which is part of the <code>PySAL</code> ecoystem. However, this is implemented under the hood by <code>geopandas</code> so that no separate <code>import</code> statement is needed for <code>mapclassify</code> itself.</p>
<p>The classification is set by means of the <code>scheme</code> argument. Common options are <code>Quantiles</code> (for a quantile map), <code>EqualInterval</code> (for an equal intervals map), <code>NaturalBreaks</code> (for a natural breaks map), <code>StdMean</code> (for a standard deviational map), and <code>BoxPlot</code> (for a box map). All but the last two classifications require an additional argument for the number of bins, <code>k</code>. This is not needed for the standard deviational map and the box map, for which the breakpoints are derived from the data, respectively the standard deviation and the quartiles/hinge.</p>
<p>The default hinge for the box map is 1.5 times the interquartile range. Other values for the hinge can be specified by setting a different value for the argument <code>hinge</code>, but this is typically not necessary. It is important to note a major difference between the implementation of this option in the underlying <code>mapclassify</code> package and its operation as part of <code>geopandas</code>. In <code>mapclassify</code>, the argument is simply <code>hinge</code>, for example, <code>hinge = 3.0</code>. In <code>geopandas</code>, this argument must be passed as part of a special dictionary, <code>classification_kwds</code>. Specifically, to change the hinge value to 3 times the interquartile range would require the argument <code>classification_kwds = {"hinge": 3.0}</code>.</p>
<p>The default for the standard deviational map is to show all observations within one standard deviation below and above the mean as one category. To separate observations below and above the mean can be accomplished by setting the argument <code>anchor</code> to <code>True</code>. Again, this is done by means of the <code>classification_kwds</code> dictionary.</p>
<p>Full details on all the classifications available through <code>mapclassify</code> and their use in <code>geopandas</code> can be found at <a href="https://geopandas.org/en/stable/docs/user_guide/mapping.html#">https://geopandas.org/en/stable/docs/user_guide/mapping.html#</a> and <a href="https://pysal.org/mapclassify/api.html">https://pysal.org/mapclassify/api.html</a>.</p>
<p>Each of the five cases is illustrated in turn. We again use the <code>column</code> argument to designate the variable to be mapped.</p>
<p>The placement of the legend is managed by means of the <code>legend_kwds</code> argument (similar in structure to <code>classification_kwds</code>). This is a dictionary that specifies aspects such as the location of the legend and how it is positioned relative to its anchor point. It also makes it possible to set a <code>title</code> for the legend, e.g., to set it to the variable that is being mapped.</p>
<p>In the examples, the following arguments are used: <code>legend_kwds={"loc": "center left", "bbox_to_anchor": (1,0.5), "title": "&lt;variable name&gt;"}</code>. This is not totally intuitive, but it works. See <a href="https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.legend.html#matplotlib.axes.Axes.legend">https://matplotlib.org/stable/api/_as_gen/matplotlib.axes.Axes.legend.html#matplotlib.axes.Axes.legend</a> for details about the various legend customizations.</p>
<p>Also note that the map examples so far use the default color map. More appropriate color maps will be considered in <a href="#sec-colormap" class="quarto-xref"><span>Section 2.3.2</span></a>.</p>
<section id="quantile-map" class="level4" data-number="2.3.1.1">
<h4 data-number="2.3.1.1" class="anchored" data-anchor-id="quantile-map"><span class="header-section-number">2.3.1.1</span> Quantile Map</h4>
<p>A simple six category quantile map is illustrated by setting <code>scheme = "Quantiles"</code> and <code>k = 6</code>. The <code>legend_kwds</code> arguments now also include a <code>title</code>. In addition, two <code>ax</code> methods are used for a minor customization: <code>ax.set_title</code> to give the map a title and, as before, <code>ax.set_axis_off</code> to get rid of the box with x-y coordinates.</p>
<div id="cell-fig-quantile-map" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> <span class="st">'Quantiles'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">6</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Quantiles"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-quantile-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-quantile-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-quantile-map-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-quantile-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: Quantile map
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="maps-with-a-set-number-of-bins" class="level4" data-number="2.3.1.2">
<h4 data-number="2.3.1.2" class="anchored" data-anchor-id="maps-with-a-set-number-of-bins"><span class="header-section-number">2.3.1.2</span> Maps with a Set Number of Bins</h4>
<p>Rather than repeating the single command for each type of map that needs the argument <code>k</code>, we construct a small loop that creates each in turn. This is accomplished by putting the name for the respective <code>scheme</code> in a list and using that same name as the map title. The three types are <code>Quantiles</code>, <code>EqualInterval</code> and <code>NaturalBreaks</code>.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>schemek <span class="op">=</span> [<span class="st">"Quantiles"</span>,<span class="st">"EqualInterval"</span>,<span class="st">"NaturalBreaks"</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> schemek:</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> i,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">6</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    ax.set_title(i)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-map-bins" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="8">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-map-bins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div id="fig-map-bins-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-map-bins-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-map-bins-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-map-bins">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-map-bins-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Quantile
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-map-bins-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-map-bins-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-map-bins-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-map-bins">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-map-bins-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Equal interval
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-map-bins-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-map-bins-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-map-bins-output-3.png" class="img-fluid figure-img" data-ref-parent="fig-map-bins">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-map-bins-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Natural breaks
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-map-bins-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.5: Maps with set number of classifications
</figcaption>
</figure>
</div>
</div>
<p>Note the contrast in the visualization of the spatial distribution between the different classifications. It is important to keep in mind that each map type has pros and cons. For example, the quantile map yields an equal number of observations in each category, but the range of the categories can vary subtantially, resulting in the grouping of very disparate observations. In the example, this is the case for the top category, which ranges from 1.8 to 124.9.</p>
<p>The range in an equal intervals map is the same for all categories, but as a result some bins may have very few or very many observations, as is the case here for the lowest bins.</p>
<p>Finally, a natural breaks map uses an optimization criterion (essentially equivalent to k-means on one variable) to determine the grouping of observations. Both the number of observations in each bin and the range of the bins is variable.</p>
</section>
<section id="maps-with-a-predetermined-number-of-bins" class="level4" data-number="2.3.1.3">
<h4 data-number="2.3.1.3" class="anchored" data-anchor-id="maps-with-a-predetermined-number-of-bins"><span class="header-section-number">2.3.1.3</span> Maps with a Predetermined Number of Bins</h4>
<p>The standard deviational map and box map have a pre-set number of bins, depending on, respectively, standard deviational units and quantiles/interquantile range. Again, they are illustrated using a small loop.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>schemenok <span class="op">=</span> [<span class="st">"StdMean"</span>,<span class="st">"BoxPlot"</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> schemenok:</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> i,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    ax.set_title(i)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-stdevbox-map" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="9">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stdevbox-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div id="fig-stdevbox-map-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-stdevbox-map-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-stdevbox-map-output-1.png" class="img-fluid figure-img" data-ref-parent="fig-stdevbox-map">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-stdevbox-map-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Standard deviational map
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-stdevbox-map-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-stdevbox-map-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-stdevbox-map-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-stdevbox-map">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-stdevbox-map-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Box map
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stdevbox-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.6: Maps with predetermined number of bins
</figcaption>
</figure>
</div>
</div>
<p>Both types of maps are designed to highlight outliers. In the standard deviational map, these are observations more than two standard deviations away from the mean, in the box map, the outliers are outside the hinge (1.5 times the interquartile range from the median). As mentioned, the defaults can be customized by setting a different value for the hinge through the <code>classification_kwds</code> argument. For example, selecting only the most extreme observations is achieved by setting <code>classification_kwds = {"hinge": 3.0}</code>, as illustrated below.</p>
<p>Note that since the bins are created based on deviations from the mean or median, the low ranges can start at -inf, which doesnâ€™t really make sense.</p>
<div id="cell-fig-boxmap-anchor" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> <span class="st">'BoxPlot'</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">6</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    classification_kwds <span class="op">=</span> {<span class="st">'hinge'</span>: <span class="fl">3.0</span>},</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Box Map"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-boxmap-anchor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxmap-anchor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-boxmap-anchor-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxmap-anchor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.7: Box map with anchor
</figcaption>
</figure>
</div>
</div>
</div>
<p>To avoid the negative bins, we can use the argument <code>classification_kwds = {"anchor" : True}</code> to ensure the lower boundary of the classification starts at 0 or the minimum value in the data. A standard deviational map with the categories below and above the mean shown is implemented with <code>classification_kwds = {"anchor" : True}</code>, as shown below.</p>
<div id="cell-fig-stdevmap-anchor" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> <span class="st">'StdMean'</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">6</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    classification_kwds <span class="op">=</span> {<span class="st">'anchor'</span>: <span class="va">True</span>},</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Standard Deviational Map"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-stdevmap-anchor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stdevmap-anchor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-stdevmap-anchor-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stdevmap-anchor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.8: Standard deviational map with anchor
</figcaption>
</figure>
</div>
</div>
</div>
<p>Whereas the first three types of classifications have a color scheme that suggests a progression from low to high values, a so-called <em>sequential</em> legend, the standard deviational map and box map focus on differences from a central value. This requires a color map that highlights the move away from the center, a so-called <em>diverging</em> legend. In the examples shown so far, the categories were visualized with the default sequential color map, which is not the best choice. The needed customizations are considered next.</p>
</section>
</section>
<section id="sec-colormap" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="sec-colormap"><span class="header-section-number">2.3.2</span> Color Map</h3>
<p>The color scheme for the map is set by means of the <code>cmap</code> argument. This refers to a <code>matplotlib</code> color map, i.e., a pre-determined range of colors optimized for a particular purpose. For example, this allows for a different color map to represent a sequential vs.&nbsp;a diverging legend.</p>
<p>The full range of color maps can be found at <a href="https://matplotlib.org/stable/users/explain/colors/colormaps.html">https://matplotlib.org/stable/users/explain/colors/colormaps.html</a>.</p>
<p>For our purposes, a good sequential color map uses a gradation that goes from light to dark, either in the same color, such as <code>cmap = "Blues"</code>, or moving between colors, such as <code>cmap = "YlOrRd"</code>. For a diverging legend, going from one extreme color to another is preferred, e.g., dark blue to light blue and then to light red and dark red, as in <code>cmap = "bwr"</code>, or even more extreme, as in <code>cmap = "seismic"</code>.</p>
<p>Some examples are shown below.</p>
<div id="cell-fig-quantmap-blues" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> <span class="st">'Quantiles'</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">6</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> <span class="st">'Blues'</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Quantiles"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-quantmap-blues" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-quantmap-blues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-quantmap-blues-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-quantmap-blues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.9: Quantile map with Blues color map
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-quantmap-ylorrd" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> <span class="st">'Quantiles'</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> <span class="dv">6</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> <span class="st">'YlOrRd'</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Quantiles"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-quantmap-ylorrd" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-quantmap-ylorrd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-quantmap-ylorrd-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-quantmap-ylorrd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.10: Quantile map with YlOrRd color map
</figcaption>
</figure>
</div>
</div>
</div>
<div id="cell-fig-boxmap-seismic" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> <span class="st">'BoxPlot'</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> <span class="st">'seismic'</span>,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    legend_kwds<span class="op">=</span>{<span class="st">"loc"</span>:<span class="st">"center left"</span>,<span class="st">"bbox_to_anchor"</span>:(<span class="dv">1</span>,<span class="fl">0.5</span>), <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Box Map"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-boxmap-seismic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boxmap-seismic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-boxmap-seismic-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxmap-seismic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.11: Box map with seismic color map
</figcaption>
</figure>
</div>
</div>
</div>
<p>However, notice what happens when this is applied to the standard deviational map with <code>cmap = bwr</code> and the conventional classification (i.e., no <code>anchor</code> argument).</p>
<div id="cell-fig-stdevmap-no-outlines" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> <span class="st">'StdMean'</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> <span class="st">'bwr'</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Standard Deviational Map"</span>)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-stdevmap-no-outlines" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stdevmap-no-outlines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-stdevmap-no-outlines-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stdevmap-no-outlines-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.12: Standard deviational map without area outlines
</figcaption>
</figure>
</div>
</div>
</div>
<p>This is not exactly what we had in mind. Other than the classification being strange, the community areas cannot be distinguished. The reason is that there is no borderline specified for the map. This final customization is considered next.</p>
</section>
<section id="areal-outlines" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="areal-outlines"><span class="header-section-number">2.3.3</span> Areal Outlines</h3>
<p>As mentioned, the full range of <code>matplotlib</code> customizations is available to manipulate legends, colors and placement. For our purposes, one more map-specific element is of interest. As seen in the previous examples, the border between polygons is not visible.</p>
<p>This can be fixed by setting the <code>edgecolor</code> and associated <code>linewidth</code> attributes. For example, with <code>edgecolor = "Black"</code> and <code>linewidth = 0.2</code>, the standard deviational map becomes somewhat more informative.</p>
<div id="cell-fig-stdevmap-edgecolor" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> <span class="st">'StdMean'</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> <span class="st">'bwr'</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    edgecolor <span class="op">=</span> <span class="st">"Black"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    linewidth <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Standard Deviational Map"</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-stdevmap-edgecolor" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-stdevmap-edgecolor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-stdevmap-edgecolor-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-stdevmap-edgecolor-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.13: Standard deviational map with edgecolor
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="saving-the-map-to-a-file" class="level3" data-number="2.3.4">
<h3 data-number="2.3.4" class="anchored" data-anchor-id="saving-the-map-to-a-file"><span class="header-section-number">2.3.4</span> Saving the Map to a File</h3>
<p>So far, the maps are generated in the interface, but are not separately available. To save a specific map to a file, the <code>matplotlib.pyplot.savefig</code> command is used (in our examples, abbreviated to <code>plt.savefig</code>). For example, to save the standard deviational map (or any other map) to a png format file, only the filename needs to be specified as an argument to <code>plt.savefig</code>. Optionally, to get higher quality figures, the number of dots per inch can be set by means of <code>dpi</code>.</p>
<p>This is illustrated for the standard deviational map where a border line is obtained as before by setting the thickness with <code>linewidth = 0.2</code>. The quality is set to <code>dpi = 600</code>.</p>
<p>The file will be in the current working directory.</p>
<div id="cell-fig-savemap" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.plot(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    column <span class="op">=</span> plotvar,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    scheme <span class="op">=</span> <span class="st">'StdMean'</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    classification_kwds <span class="op">=</span> {<span class="st">'anchor'</span>: <span class="va">True</span>},</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    cmap <span class="op">=</span> <span class="st">'bwr'</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    edgecolor <span class="op">=</span> <span class="st">"Black"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    linewidth <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    legend <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    legend_kwds <span class="op">=</span> {<span class="st">"loc"</span>: <span class="st">"center left"</span>, <span class="st">"bbox_to_anchor"</span>: (<span class="dv">1</span>,<span class="fl">0.5</span>), </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"title"</span>: <span class="st">"Population Change"</span>}</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Standard Deviational Map"</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>plt.savefig(<span class="st">"popchange_stdmean.png"</span>, dpi <span class="op">=</span> <span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-savemap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-savemap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-savemap-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-savemap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.14: Saving the map to a file
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="mapping-polygon-boundaries" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="mapping-polygon-boundaries"><span class="header-section-number">2.4</span> Mapping Polygon Boundaries</h2>
<p>A map with just the community area borders is obtained with the <code>boundary.plot</code> command, where the color of the border line is controlled by <code>edgecolor</code> and the line thickness by <code>linewidth</code>, as before.</p>
<div id="cell-fig-boundplot" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> chi_comm.boundary.plot(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    edgecolor <span class="op">=</span> <span class="st">"Black"</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    linewidth <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Community Area Boundaries"</span>)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-boundplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-boundplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-boundplot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boundplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.15: Boundary plot
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="mapping-point-data" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="mapping-point-data"><span class="header-section-number">2.5</span> Mapping Point Data</h2>
<p>So far, in this example, we used a shapefile containing polygon or areal spatial data. Alternatively, we can plot point data, which can be loaded the same way as before from a shapefile, or from a spreadsheet as a .CSV file.</p>
<p>In the following examples, we will use the location of liquor stores in Chicago, IL, contained in the <code>point_df</code> GeoDataFrame we loaded in <a href="#sec-loaddata" class="quarto-xref"><span>Section 2.1.2</span></a>.</p>
<p>As before, a simple visualization of the data can be obtained with the <code>.plot</code> function. Here, we add two optional arguments: <code>markersize = 4</code> and <code>color = 'blue'</code>, which control the size of the dots on the map and their color.</p>
<div id="cell-fig-pointplot" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>point_df.plot(markersize <span class="op">=</span> <span class="dv">4</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-pointplot" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pointplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-pointplot-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pointplot-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.16: Simple plot of point data
</figcaption>
</figure>
</div>
</div>
</div>
<section id="points-with-polygons" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="points-with-polygons"><span class="header-section-number">2.5.1</span> Points with Polygons</h3>
<p>The simple visualization of points in space lacks context and is often not that meaningful. One typically wants to show the points on a background of polygons, such as the Chicago community areas in this example. By using the <code>ax</code> parameter, it becomes straightforward to combine different graphs in one figure, in this case a point map and a polygon map. However, an important consideration is to make sure the two layers are in the same projection. As it turns out, in our example, they are not. In fact, the community areas are not projected (latitude-longitude decimal degrees), but the point data have a projection of UTM zone 16N.</p>
<p>Whereas an in-depth discussion of projections is well beyond our scope (for specifics, see Chapter 3 of the <em>GeoDa Explore Book</em>), it is useful to know that <code>geopandas</code> contains a simple way to synchronize the projections of two layers in the form of <code>to_crs</code>. In our example, we set the projection of the community areas to that of the point layer by means of <code>chi_comm.to_crs(point_df.crs)</code>.</p>
<p>To overlay the points on the community areas, we can use the <code>ax</code> parameter in the <code>plot()</code> function to specify the same axes for both plots. We specify the size of the figure and then apply the <code>plot</code> function to the polygon layer (<code>chi_comm</code>) and the point layer (<code>point_df</code>) in turn. We just draw the outlines for the polygon map (as illustrated above) with a customized <code>linewidth</code> and use <code>markersize</code> and <code>color</code> for the points.</p>
<p>The result is a map of the liquor locations overlayed on the community area outlines.</p>
<div id="cell-fig-multilayer-map" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Converting the layers to the same projection (CRS)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>chi_comm <span class="op">=</span> chi_comm.to_crs(point_df.crs)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the figure with both layers</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize <span class="op">=</span> (<span class="dv">6</span>, <span class="dv">8</span>))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>chi_comm.boundary.plot(ax <span class="op">=</span> ax, edgecolor <span class="op">=</span> <span class="st">'black'</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span>) </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>point_df.plot(ax <span class="op">=</span> ax, markersize <span class="op">=</span> <span class="dv">4</span>, color <span class="op">=</span> <span class="st">'blue'</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Liquor Stores in Chicago's Community Areas"</span>)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>ax.set_axis_off()</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-multilayer-map" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-multilayer-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Creating_maps_files/figure-html/fig-multilayer-map-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-multilayer-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.17: Multilayer map
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="practice" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="practice"><span class="header-section-number">2.6</span> Practice</h2>
<p>Use your own data set or one of the GeoDa Center or PySAL sample data sets to load a spatial data frame and experiment with various map types, color schemes and other customizations. Save each map to a file for inclusion in papers, reports, etc.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./introduction.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Multivariate_local.html" class="pagination-link" aria-label="Multivariate Local Spatial Clusters">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Multivariate Local Spatial Clusters</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025 GeoDa Press LLC, All Rights Reserved</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>