<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Hierarchical Clustering Methods – The Python Companion to Spatial Cluster Analysis with GeoDa</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./kmeans.html" rel="next">
<link href="./MDS.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-485d01fc63b59abcd3ee1bf1e8e2748d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./hierarchical_clustering.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hierarchical Clustering Methods</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./logo.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The Python Companion to Spatial Cluster Analysis with GeoDa</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Creating_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Creating Thematic Maps</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Multivariate_local.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Multivariate Local Spatial Clusters</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Density_cluster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Density Based Clustering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./PCA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Principal Component Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./MDS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Distance Preserving Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hierarchical_clustering.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hierarchical Clustering Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kmeans.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Partitioning Clustering Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./kmedoids.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Clustering Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spectral_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Spectral Clustering</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spatializing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Spatializing Classic Clustering Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./hierarchical_spatial_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Spatially Constrained Clustering - Hierarchical Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./partitioned_spatial_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Spatially Constrained Clustering - Partitioning Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cluster_validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Cluster Validation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bibliography.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link active" data-scroll-target="#preliminaries"><span class="header-section-number">7.1</span> Preliminaries</a>
  <ul class="collapse">
  <li><a href="#import-required-modules" id="toc-import-required-modules" class="nav-link" data-scroll-target="#import-required-modules"><span class="header-section-number">7.1.1</span> Import Required Modules</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data"><span class="header-section-number">7.1.2</span> Load Data</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables"><span class="header-section-number">7.1.3</span> Variables</a></li>
  </ul></li>
  <li><a href="#wards-method" id="toc-wards-method" class="nav-link" data-scroll-target="#wards-method"><span class="header-section-number">7.2</span> Ward’s method</a>
  <ul class="collapse">
  <li><a href="#sec-clustercompute" id="toc-sec-clustercompute" class="nav-link" data-scroll-target="#sec-clustercompute"><span class="header-section-number">7.2.1</span> Cluster Computation</a></li>
  <li><a href="#sec-dendrogram" id="toc-sec-dendrogram" class="nav-link" data-scroll-target="#sec-dendrogram"><span class="header-section-number">7.2.2</span> Dendrogram</a></li>
  <li><a href="#cluster-centers" id="toc-cluster-centers" class="nav-link" data-scroll-target="#cluster-centers"><span class="header-section-number">7.2.3</span> Cluster Centers</a></li>
  <li><a href="#cluster-fit" id="toc-cluster-fit" class="nav-link" data-scroll-target="#cluster-fit"><span class="header-section-number">7.2.4</span> Cluster Fit</a></li>
  <li><a href="#cluster-map" id="toc-cluster-map" class="nav-link" data-scroll-target="#cluster-map"><span class="header-section-number">7.2.5</span> Cluster Map</a></li>
  </ul></li>
  <li><a href="#other-linkage-functions" id="toc-other-linkage-functions" class="nav-link" data-scroll-target="#other-linkage-functions"><span class="header-section-number">7.3</span> Other Linkage Functions</a></li>
  <li><a href="#practice" id="toc-practice" class="nav-link" data-scroll-target="#practice"><span class="header-section-number">7.4</span> Practice</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-hierclust" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Hierarchical Clustering Methods</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this Chapter, we begin our overview of traditional clustering methods by considering techniques that build up the clusters step-by-step, in a <em>hierarchical</em> fashion. There are two approaches. One, <em>agglomerative</em> clustering, starts from the bottom and works its way up. More precisely, initially, each observation forms a separate cluster. Subsequently, pairs of observations are systematically grouped into larger entities, until the whole data set forms one cluster. In the other approach, <em>divisive</em> clustering, the opposite path is taken. One starts with the full set of observations as one cluster, and subsequently splits this into subclusters until each observation is again its own cluster. In the current Chapter, we only consider agglomerative clustering. A form of divisive clustering is included in the discussion of spatially constrained clustering in <a href="hierarchical_spatial_clustering.html" class="quarto-xref">Chapter&nbsp;<span>12</span></a>. Hierarchical clustering methods are covered in Chapter 5 of the <em>GeoDa Cluster Book</em>.</p>
<p>There are two important elements to be considered in the grouping of observations:</p>
<ul>
<li><em>linkage</em> option, i.e., how to decide which observations/clusters are <em>closest</em></li>
<li><em>update</em> function, i.e., how to compute the <em>distance</em> between clusters once they are formed from different observations</li>
</ul>
<p>The main methods are characterized by different linkage options. We consider the four most common ones, i.e., <em>Ward’s</em> method, <em>single linkage</em>, <em>complete linkage</em> and <em>average linkage</em>.</p>
<p>An important aspect of hierarchical clustering is the so-called <em>dendrogram</em>, which visualizes the process of grouping observations/entities into larger entities and the associated distance criterion. The number of clusters is not set initially, but is determined by a <em>cut</em> of the dendrogram.</p>
<p>We focus mostly on Ward’s method, which is arguably the most robust and most commonly used method. However, it only works for a squared distance criterion, whereas other measures work with any distance.</p>
<p>Hierarchical clustering is in implemented through <code>AgglomerativeClustering</code> from <code>sklearn.cluster</code>. An alternative method to obtain hierarchical clusters, which is somewhat easier to visualize, is contained in <code>scipy.cluster.hierarchy</code>. As before, we will also need <code>StandardScaler</code> from <code>sklearn.preprocessing</code> to standardize the data. In order to implement some of the <em>spatialization</em> of these methods, we import several functions from the <code>spatial-cluster-helper</code> package:</p>
<ul>
<li><code>ensure_datasets</code></li>
<li><code>cluster_stats</code></li>
<li><code>plot_dendrogram</code></li>
<li><code>cluster_center</code></li>
<li><code>cluster_fit</code></li>
<li><code>cluster_map</code></li>
</ul>
<p>As before, we will also need <code>numpy</code>, <code>geopandas</code> and <code>matplotlib.pyplot</code>.</p>
<p>To illustrate these methods, we will use the <strong>Chi-CCA</strong> sample data set with socio-economic determinants of health for Community Areas in 2020 in Chicago, IL. It has only 77 observations, which facilitates the drawing of a dendrogram. The latter becomes difficult for larger data sets.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Required Packages">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Required Packages
</div>
</div>
<div class="callout-body-container callout-body">
<p>numpy, geopandas, matplotlib.pyplot, sklearn.cluster, sklearn.preprocessing, scipy.cluster.hierarchy, spatial-cluster-helper</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Required Data Sets">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Required Data Sets
</div>
</div>
<div class="callout-body-container callout-body">
<p>Chi-CCA</p>
</div>
</div>
<section id="preliminaries" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="preliminaries"><span class="header-section-number">7.1</span> Preliminaries</h2>
<section id="import-required-modules" class="level3" data-number="7.1.1">
<h3 data-number="7.1.1" class="anchored" data-anchor-id="import-required-modules"><span class="header-section-number">7.1.1</span> Import Required Modules</h3>
<div id="e49b893f" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> AgglomerativeClustering</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.cluster.hierarchy <span class="im">import</span> dendrogram, linkage</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> spatial_cluster_helper <span class="im">import</span> ensure_datasets,cluster_stats, <span class="op">\</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>               plot_dendrogram, cluster_center, cluster_fit, cluster_map</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-data" class="level3" data-number="7.1.2">
<h3 data-number="7.1.2" class="anchored" data-anchor-id="load-data"><span class="header-section-number">7.1.2</span> Load Data</h3>
<p>We follow the usual practice of setting a path (if needed), read the data from the <code>Chicago_2020_sdoh</code> shape file and carry out a quick check of its contents.</p>
<div id="a2bd865b" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting working folder:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#path = "/your/path/to/data/"</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">"./datasets/"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the Chicago community area data:</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>shpfile <span class="op">=</span> <span class="st">"Chi_CCA/Chicago_2020_sdoh.shp"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data:</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>ensure_datasets(shpfile, folder_path <span class="op">=</span> path)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>dfs <span class="op">=</span> gpd.read_file(path <span class="op">+</span> shpfile)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dfs.shape)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>dfs.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(77, 233)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="2">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">area_num_1</th>
<th data-quarto-table-cell-role="th">community</th>
<th data-quarto-table-cell-role="th">shape_area</th>
<th data-quarto-table-cell-role="th">shape_len</th>
<th data-quarto-table-cell-role="th">districtno</th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">TOT_POP</th>
<th data-quarto-table-cell-role="th">2000_POP</th>
<th data-quarto-table-cell-role="th">2010_POP</th>
<th data-quarto-table-cell-role="th">UND5</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">KOREAN</th>
<th data-quarto-table-cell-role="th">OTHASIAN</th>
<th data-quarto-table-cell-role="th">OTHER_EURO</th>
<th data-quarto-table-cell-role="th">OTHUNSPEC</th>
<th data-quarto-table-cell-role="th">2000_WHITE</th>
<th data-quarto-table-cell-role="th">2000_HISP</th>
<th data-quarto-table-cell-role="th">2000_BLACK</th>
<th data-quarto-table-cell-role="th">2000_ASIAN</th>
<th data-quarto-table-cell-role="th">2000_OTHER</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>35.0</td>
<td>DOUGLAS</td>
<td>4.600462e+07</td>
<td>31027.054510</td>
<td>7.0</td>
<td>South Side</td>
<td>21325.0</td>
<td>26470.0</td>
<td>18238.0</td>
<td>1107.0</td>
<td>...</td>
<td>145.0</td>
<td>571.0</td>
<td>1290.0</td>
<td>555.0</td>
<td>1745.0</td>
<td>295.0</td>
<td>22635.0</td>
<td>1390.0</td>
<td>405.0</td>
<td>POLYGON ((-87.60914 41.84469, -87.60915 41.844...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>36.0</td>
<td>OAKLAND</td>
<td>1.691396e+07</td>
<td>19565.506153</td>
<td>7.0</td>
<td>South Side</td>
<td>7227.0</td>
<td>6110.0</td>
<td>5918.0</td>
<td>574.0</td>
<td>...</td>
<td>0.0</td>
<td>22.0</td>
<td>98.0</td>
<td>342.0</td>
<td>40.0</td>
<td>58.0</td>
<td>5957.0</td>
<td>8.0</td>
<td>47.0</td>
<td>POLYGON ((-87.59215 41.81693, -87.59231 41.816...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>37.0</td>
<td>FULLER PARK</td>
<td>1.991670e+07</td>
<td>25339.089750</td>
<td>7.0</td>
<td>South Side</td>
<td>2394.0</td>
<td>3420.0</td>
<td>2876.0</td>
<td>120.0</td>
<td>...</td>
<td>0.0</td>
<td>0.0</td>
<td>15.0</td>
<td>0.0</td>
<td>18.0</td>
<td>116.0</td>
<td>3225.0</td>
<td>6.0</td>
<td>55.0</td>
<td>POLYGON ((-87.6288 41.80189, -87.62879 41.8017...</td>
</tr>
</tbody>
</table>

<p>3 rows × 233 columns</p>
</div>
</div>
</div>
<div id="c4524a8e" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the full set of variables</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(dfs.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['area_num_1', 'community', 'shape_area', 'shape_len', 'districtno', 'district', 'TOT_POP', '2000_POP', '2010_POP', 'UND5', 'A5_19', 'A65_74', 'A75_84', 'OV85', 'WHITE', 'UNEMP', 'NO_VEH', 'POP_25OV', 'LT_HS', 'MEDINC', 'TOT_HH', 'OWN_OCC_HU', 'RENTOCCHU', 'VAC_HU', 'HU_TOT', 'MED_HA', 'MED_HV', 'MED_RENT', 'AVG_VMT', 'FOR_BORN', 'POP_OV5', 'NOTENGLISH', 'LING_ISO', 'INCPERCAP', 'Und20', 'Ov65', 'Minrty', 'Unemprt', 'Noveh', 'Lt_high', 'Rentocc', 'Rntburd', 'Noeng', 'Vacant', 'Forborn', 'Ownocc', 'Liteng', 'CLhc5', 'GEOID', 'GEOG', 'A5_20', 'A20_34', 'A35_49', 'A50_64', 'A65_75', 'A75_85', 'MED_AGE', 'HISP', 'BLACK', 'ASIAN', 'OTHER', 'POP_HH', 'POP_16OV', 'IN_LBFRC', 'EMP', 'N_IN_LBFRC', 'T_WRKR16OV', 'WORK_HOME', 'TOT_COMM', 'DROVE_AL', 'CARPOOL', 'TRANSIT', 'WALK_BIKE', 'COMM_OTHER', 'AGG_TT', 'ONE_VEH', 'TWO_VEH', 'THREEP_VEH', 'HS', 'SOME_COLL', 'ASSOC', 'BACH', 'GRAD_PROF', 'INCLT25K', 'INC2550K', 'INC5075K', 'INC75100K', 'INC100150K', 'INC_GT_150', 'HU_SNG_DET', 'HU_SNG_ATT', 'HU_2UN', 'HU_3_4UN', 'HU_5_9UN', 'HU_10_19UN', 'HU_GT_19UN', 'HU_MOBILE', 'MED_ROOMS', 'HA_AFT2000', 'HA_70_00', 'HA_40_70', 'HA_BEF1940', 'BR_0_1', 'BR_2', 'BR_3', 'BR_4', 'BR_5', 'HVLT150K', 'HV150300K', 'HV300500K', 'HVGT500K', 'CASHRENTHH', 'RENT_LT500', 'RENT500999', 'RT10001499', 'RT15002499', 'RENTGT2500', 'COMPUTER', 'SMARTPHONE', 'NOCOMPUTER', 'INTERNET', 'BROADBAND', 'NOINTERNET', 'TEMPRES', 'RESNAICS1T', 'RESNAICS2T', 'RESNAICS3T', 'RESNAICS4T', 'RESNAICS5T', 'RESNAICS1C', 'RESNAICS2C', 'RESNAICS3C', 'RESNAICS4C', 'RESNAICS5C', 'TOTEMPWRK', 'WRKNAICS1T', 'WRKNAICS2T', 'WRKNAICS3T', 'WRKNAICS4T', 'WRKNAICS5T', 'WRKNAICS1C', 'WRKNAICS2C', 'WRKNAICS3C', 'WRKNAICS4C', 'WRKNAICS5C', 'RESCITY1T', 'RESCITY2T', 'RESCITY3T', 'RESCITY4T', 'RESCITY5T', 'RESCITY1C', 'RESCITY2C', 'RESCITY3C', 'RESCITY4C', 'RESCITY5C', 'WRKCITY1T', 'WRKCITY2T', 'WRKCITY3T', 'WRKCITY4T', 'WRKCITY5T', 'WRKCITY1C', 'WRKCITY2C', 'WRKCITY3C', 'WRKCITY4C', 'WRKCITY5C', 'AVG_VMT_1', 'TRANSLOPCT', 'TRANSMDPCT', 'TRANSHIPCT', 'WALKLOWPCT', 'WALKMODPCT', 'WALKHIPCT', 'OSPACE1000', 'TOT_ACRES', 'SF', 'Sfperc', 'MF', 'Mfperc', 'MIX', 'MIXperc', 'COMM', 'COMMperc', 'INST', 'INSTperc', 'IND', 'INDperc', 'TRANS', 'TRANSperc', 'AG', 'Agperc', 'OPEN', 'OPENperc', 'VACperc', 'CT_1PHH', 'CT_2PHH', 'CT_3PHH', 'CT_4MPHH', 'CT_FAM_HH', 'CTSPWCHILD', 'CTNONFAMHH', 'HCUND20K', 'HCUN20KL20', 'HCU20_2029', 'HCU20_30', 'HC20Kto49K', 'HC2049L20', 'HC20492029', 'HC204930', 'HC5075K', 'HC5075LT20', 'HC50752029', 'HC507530M', 'HCOV75K', 'HCOV75L20P', 'HCOV752029', 'HCOV7530M', 'NATIVE', 'ENGLISH', 'SPANISH', 'SLAVIC', 'CHINESE', 'TAGALOG', 'ARABIC', 'KOREAN', 'OTHASIAN', 'OTHER_EURO', 'OTHUNSPEC', '2000_WHITE', '2000_HISP', '2000_BLACK', '2000_ASIAN', '2000_OTHER', 'geometry']</code></pre>
</div>
</div>
</section>
<section id="variables" class="level3" data-number="7.1.3">
<h3 data-number="7.1.3" class="anchored" data-anchor-id="variables"><span class="header-section-number">7.1.3</span> Variables</h3>
<p>We replicate the illustration in Chapter 5 of the <em>GeoDa Cluster Book</em> and use a subset of socio-economic determinants of health from the study by <span class="citation" data-cites="Kolaketal20">Kolak et al. (<a href="bibliography.html#ref-Kolaketal20" role="doc-biblioref">2020</a>)</span> that included all the U.S. census tracts.</p>
<div id="tbl-variables-hierarchical" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-variables-hierarchical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7.1: Variables for Hierarchical Clustering
</figcaption>
<div aria-describedby="tbl-variables-hierarchical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 85%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Column Name</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">INCPERCAP</td>
<td style="text-align: left;">Per capita income</td>
</tr>
<tr class="even">
<td style="text-align: left;">Und20</td>
<td style="text-align: left;">Population share aged &lt; 20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ov65</td>
<td style="text-align: left;">Population share aged &gt; 65</td>
</tr>
<tr class="even">
<td style="text-align: left;">Minrty</td>
<td style="text-align: left;">Percentage of minority population</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unemprt</td>
<td style="text-align: left;">Unemployment rate</td>
</tr>
<tr class="even">
<td style="text-align: left;">Noveh</td>
<td style="text-align: left;">Percentage of households with no vehicle</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Lt_high</td>
<td style="text-align: left;">Percentage of population without high school education</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rentocc</td>
<td style="text-align: left;">Percentage of renter-occupied housing</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rntburd</td>
<td style="text-align: left;">Rent burden</td>
</tr>
<tr class="even">
<td style="text-align: left;">Noeng</td>
<td style="text-align: left;">Percentage of population with limited English proficiency</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The selected variables are included in <code>varlist</code>, as before. We also create a separate <code>data_cluster</code> DataFrame with just those variables and provide some descriptive statistics.</p>
<div id="21ec3a2c" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>varlist <span class="op">=</span> [<span class="st">'INCPERCAP'</span>, <span class="st">'Und20'</span>, <span class="st">'Ov65'</span>, <span class="st">'Minrty'</span>, <span class="st">'Unemprt'</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>           <span class="st">'Noveh'</span>, <span class="st">'Lt_high'</span>, <span class="st">'Rentocc'</span>, <span class="st">'Rntburd'</span>, <span class="st">'Noeng'</span>]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>data_cluster <span class="op">=</span> dfs[varlist]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">round</span>(data_cluster.describe(), <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">INCPERCAP</th>
<th data-quarto-table-cell-role="th">Und20</th>
<th data-quarto-table-cell-role="th">Ov65</th>
<th data-quarto-table-cell-role="th">Minrty</th>
<th data-quarto-table-cell-role="th">Unemprt</th>
<th data-quarto-table-cell-role="th">Noveh</th>
<th data-quarto-table-cell-role="th">Lt_high</th>
<th data-quarto-table-cell-role="th">Rentocc</th>
<th data-quarto-table-cell-role="th">Rntburd</th>
<th data-quarto-table-cell-role="th">Noeng</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>77.00</td>
<td>77.00</td>
<td>77.00</td>
<td>77.00</td>
<td>77.00</td>
<td>77.00</td>
<td>77.00</td>
<td>77.00</td>
<td>77.00</td>
<td>77.00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>32501.26</td>
<td>24.56</td>
<td>13.69</td>
<td>72.05</td>
<td>10.56</td>
<td>12.73</td>
<td>16.00</td>
<td>45.20</td>
<td>25.71</td>
<td>33.38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>19482.12</td>
<td>6.35</td>
<td>4.61</td>
<td>26.91</td>
<td>6.87</td>
<td>8.01</td>
<td>9.63</td>
<td>15.75</td>
<td>8.26</td>
<td>26.73</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>11857.00</td>
<td>8.90</td>
<td>4.80</td>
<td>16.79</td>
<td>0.37</td>
<td>1.93</td>
<td>1.73</td>
<td>9.13</td>
<td>11.23</td>
<td>2.19</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>19842.00</td>
<td>20.25</td>
<td>10.12</td>
<td>51.74</td>
<td>5.01</td>
<td>6.04</td>
<td>9.12</td>
<td>31.70</td>
<td>20.40</td>
<td>7.38</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>25944.00</td>
<td>25.08</td>
<td>12.82</td>
<td>85.51</td>
<td>8.74</td>
<td>10.53</td>
<td>14.69</td>
<td>48.36</td>
<td>23.94</td>
<td>26.71</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>36736.00</td>
<td>29.41</td>
<td>16.09</td>
<td>96.37</td>
<td>15.74</td>
<td>19.92</td>
<td>21.70</td>
<td>56.20</td>
<td>29.80</td>
<td>55.36</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>101727.00</td>
<td>44.28</td>
<td>26.52</td>
<td>99.50</td>
<td>30.42</td>
<td>34.31</td>
<td>44.65</td>
<td>76.92</td>
<td>49.85</td>
<td>86.53</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="wards-method" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="wards-method"><span class="header-section-number">7.2</span> Ward’s method</h2>
<p>We start by considering Ward’s method. We illustrate four important aspects of the solution: computing the clusters (cluster labels), visualizing the dendrogram, calculating characteristics of a cluster solution, and visualizing the clusters in a <em>cluster map</em>.</p>
<section id="sec-clustercompute" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="sec-clustercompute"><span class="header-section-number">7.2.1</span> Cluster Computation</h3>
<p>One approach to obtain the cluster computation is by means of the <code>AgglomerativeClustering</code> class of scikit-learn. For details, see <a href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.AgglomerativeClustering.html">https://scikit-learn.org/stable/modules/generated/sklearn.cluster.AgglomerativeClustering.html</a>. The second option, using <code>scipy.cluster.hierarchy</code> is considered in the discussion of the dendrogram in <a href="#sec-dendrogram" class="quarto-xref"><span>Section 7.2.2</span></a>.</p>
<p>The main arguments to create an instance of the <code>AgglomerativeClustering</code> class are the number of clusters, <code>n_clusters</code>, the <code>linkage</code> option, as well as an option to compute the distances from an initial array of inputs, <code>compute_distances = True</code>. As before, the input data frame is first standardized using <code>fit_transform</code> from <code>StandardScaler</code>. Once an instance of the class is created, the <code>fit</code> method returns the results, with the cluster labels contained in the <code>labels_</code> attribute. Other attributes are provided as well, but the labels are our main interest here (see the extended documentation for details). We summarize the results with our <code>cluster_stats</code> utility function.</p>
<p>We illustrate this for Ward’s method with a cluster size of 5.</p>
<div id="3360a669" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the desired number of clusters and linkage method</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>n_clusters <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>method <span class="op">=</span> <span class="st">'ward'</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize the data</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> StandardScaler().fit_transform(data_cluster)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Agglomerative Clustering</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>agg_clust <span class="op">=</span> AgglomerativeClustering(n_clusters <span class="op">=</span> n_clusters, </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>                    linkage <span class="op">=</span> method, compute_distances <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>agg_clust.fit(X)</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>cluster_labels <span class="op">=</span> agg_clust.labels_</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>c_stats <span class="op">=</span> cluster_stats(cluster_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Labels  Cardinality
      0           21
      1           15
      2           15
      3           13
      4           13</code></pre>
</div>
</div>
<p>The resulting clusters are labeled from 0 to 4. They are relatively balanced, with 21 observations in the largest cluster, two clusters with 15 and two clusters with 13.</p>
<p>An interesting piece of information is contained in the <code>distances_</code> attribute. This shows the distances at which each cluster is formed, increasing from the smallest distance (here 0.36) to the one between the final two clusters that form the full data set (here 20.3).</p>
<div id="64b0c852" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>agg_clust.distances_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([ 0.36274015,  0.53936027,  0.68178409,  0.71372655,  0.78778369,
        0.79647585,  0.84125925,  0.84297015,  0.85370346,  0.8831146 ,
        0.88675916,  0.92955806,  0.98841925,  1.05998996,  1.06438798,
        1.07255791,  1.0765715 ,  1.1538963 ,  1.21130411,  1.25532594,
        1.27768021,  1.32193569,  1.35293476,  1.36454495,  1.37498667,
        1.37632845,  1.39756016,  1.41986327,  1.42228951,  1.42756184,
        1.46881725,  1.51405012,  1.52158604,  1.53340115,  1.5670125 ,
        1.73174358,  1.73496471,  1.78386891,  1.84018742,  1.89045915,
        1.91123968,  1.94707456,  1.95727687,  1.99076458,  2.00088467,
        2.04991017,  2.14413004,  2.28039251,  2.31301355,  2.41508411,
        2.43475984,  2.47209374,  2.5891719 ,  2.63945666,  2.70434923,
        2.85506842,  3.01764305,  3.08092386,  3.10174269,  3.14956205,
        3.2148449 ,  4.25006606,  4.29530368,  4.56351567,  4.97645808,
        5.18803816,  5.32611836,  5.50111751,  5.85655264,  6.29068946,
        6.77711462,  7.92611783, 11.16248439, 12.85337461, 17.02788825,
       20.30116606])</code></pre>
</div>
</div>
</section>
<section id="sec-dendrogram" class="level3" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="sec-dendrogram"><span class="header-section-number">7.2.2</span> Dendrogram</h3>
<p>The scikit-learn functionality does not return a dendrogram as such. It can be constructed from various attributes of the cluster object, but this is not straightforward. Therefore, in order to visualize the hierarchy of grouping decisions, we use an alternative implementation, which is part of <code>scipy.cluster</code>, namely <code>scipy.cluster.hierarchy</code>.</p>
<p>The setup is somewhat different from the scikit-learn approach and provides functions to compute hierarchical cluster results, specifically through the <code>linkage</code> command. The function returns a hierarchical cluster as a numpy array, which can then be visualized as a <code>dendrogram</code>. In addition, other summaries are available as well, see <a href="https://docs.scipy.org/doc/scipy-1.16.0/reference/cluster.hierarchy.html">https://docs.scipy.org/doc/scipy-1.16.0/reference/cluster.hierarchy.html</a> for details.</p>
<p>We illustrate this for our example. In a first step, we create the cluster result by applying <code>linkage</code> to the array <code>X</code> with the standardized values (the same as used above). A second argument is the method, again <code>"ward"</code>. The function returns a numpy array with all the linkage information expressed in a n-1 by 4 matrix. In each row, the first two elements refer to cluster indices that are being combined, with values less than n (starting at 0) referring to original observations, and values of n and larger referring to clusters that are combinations of earlier clusters. The third column gives the inter-cluster distance, and the last column shows the number of original observations contained in the cluster.</p>
<p>The inter-cluster distance shown in the third column is the same as what we had in the <code>distances_</code> attribute of the cluster constructed with scikit-learn in <a href="#sec-clustercompute" class="quarto-xref"><span>Section 7.2.1</span></a>.</p>
<p>To illustrate this for our example, we list the first five rows. In the first row, individual observations 59 and 62 are combined to yield a cluster of two (element in column 4). In the third row, observation 50 is combined with 77, which is the first cluster (or 59 and 62). As a result, it now consists of 3 elements (shown in the fourth column).</p>
<div id="24d7d591" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Z <span class="op">=</span> linkage(X, method <span class="op">=</span> <span class="st">'ward'</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Z.shape)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Z[<span class="dv">0</span>:<span class="dv">5</span>,:])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(76, 4)
[[59.         62.          0.36274015  2.        ]
 [13.         21.          0.53936027  2.        ]
 [50.         77.          0.68178409  3.        ]
 [18.         20.          0.71372655  2.        ]
 [ 5.         22.          0.78778369  2.        ]]</code></pre>
</div>
</div>
<p>The full set of distances (column 2) is identical to the values contained in <code>distances_</code> above.</p>
<div id="04f43880" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Z[:,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>array([ 0.36274015,  0.53936027,  0.68178409,  0.71372655,  0.78778369,
        0.79647585,  0.84125925,  0.84297015,  0.85370346,  0.8831146 ,
        0.88675916,  0.92955806,  0.98841925,  1.05998996,  1.06438798,
        1.07255791,  1.0765715 ,  1.1538963 ,  1.21130411,  1.25532594,
        1.27768021,  1.32193569,  1.35293476,  1.36454495,  1.37498667,
        1.37632845,  1.39756016,  1.41986327,  1.42228951,  1.42756184,
        1.46881725,  1.51405012,  1.52158604,  1.53340115,  1.5670125 ,
        1.73174358,  1.73496471,  1.78386891,  1.84018742,  1.89045915,
        1.91123968,  1.94707456,  1.95727687,  1.99076458,  2.00088467,
        2.04991017,  2.14413004,  2.28039251,  2.31301355,  2.41508411,
        2.43475984,  2.47209374,  2.5891719 ,  2.63945666,  2.70434923,
        2.85506842,  3.01764305,  3.08092386,  3.10174269,  3.14956205,
        3.2148449 ,  4.25006606,  4.29530368,  4.56351567,  4.97645808,
        5.18803816,  5.32611836,  5.50111751,  5.85655264,  6.29068946,
        6.77711462,  7.92611783, 11.16248439, 12.85337461, 17.02788825,
       20.30116606])</code></pre>
</div>
</div>
<p>We can now proceed and graph the dendrogram. The <code>dendrogram</code> function takes the linkage array (<code>Z</code>) as well as several other arguments to fine tune the looks of the graph. The most important of these is <code>color_threshold</code>, which is the cut-off distance to define the clusters. Since the distances in <code>Z</code> are sorted from smallest to largest, the top distance corresponds to a single cluster, the next to last to a result with two clusters, etc. As a result, the cut-off distance for <code>n_clusters</code> is contained in position - (n_clusters - 1), or 1 - n_clusters from the end (a negative entry for the element). We pass this distance to <code>color_threshold</code> so that all the branches corresponding to each cluster are colored the same in the graph.</p>
<p>Other arguments are <code>orientation</code> (<code>top</code> for a top-down graph), <code>leaf_rotation</code> (<code>90</code> for the top-down graph), and <code>leaf_font_size</code> (size of the font of the observation label, here <code>7</code>). Some experimentation with these may be needed for each particular instance.</p>
<p>We use <code>plt</code> to set the <code>figsize</code> and plot the graph. There are also options to create a dendrogram for larger data sets, where the full graph is no longer practical. This is not further considered (see the detailed documentation).</p>
<p>The <code>dendrogram</code> function returns a dictionary that contains all the details necessary to construct the graph. Typically, this is not needed, except for the <code>"leaves_color_list"</code> item, which can be used to compute the <code>cluster_stats</code>.</p>
<p>First, we create the dendrogram.</p>
<div id="cell-fig-dendrogram" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">12</span>,<span class="dv">7</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>R1 <span class="op">=</span> dendrogram(Z, orientation <span class="op">=</span> <span class="st">'top'</span>, leaf_rotation <span class="op">=</span> <span class="dv">90</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>           leaf_font_size <span class="op">=</span> <span class="dv">7</span>, color_threshold <span class="op">=</span> Z[<span class="dv">1</span><span class="op">-</span>n_clusters, <span class="dv">2</span>])</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-dendrogram" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dendrogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_clustering_files/figure-html/fig-dendrogram-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dendrogram-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.1: Dendrogram
</figcaption>
</figure>
</div>
</div>
</div>
<p>The dendrogram illustrates the steps by which the clusters are constructed, with the horizontal bars drawn at the height of the corresponding distance. For example, from the contents of <code>Z</code> above, we know that the first step is to combine 59 and 62, for a distance of 0.36. Indeed, we can find the lowest horizontal bar connecting 59 and 62 in the purple cluster. The second grouping, between 13 and 21, for a distance of 0.54 is shown in the brown cluster, etc.</p>
<p>An interesting side result of the dendrogram calculation dictionary is the <code>"leaves_color_list"</code> item. It contains the color codes associated with each cluster as a distinct string. We can now use the <code>cluster_stats</code> function from our helper module to create a table with the cluster cardinality (the only argument is the list of labels). Note that unlike what is the case in scikit-learn, cluster labels are not explicitly provided by the <code>scipy.cluster.hierarchy</code> functionality.</p>
<p>The result again shows the five clusters, but now in a slightly different order.</p>
<div id="af835fff" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>c_stats <span class="op">=</span> cluster_stats(R1[<span class="st">"leaves_color_list"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Labels Cardinality
    C1          13
    C2          15
    C3          15
    C4          13
    C5          21</code></pre>
</div>
</div>
<section id="plot_dendrogram-helper-function" class="level4" data-number="7.2.2.1">
<h4 data-number="7.2.2.1" class="anchored" data-anchor-id="plot_dendrogram-helper-function"><span class="header-section-number">7.2.2.1</span> <code>plot_dendrogram</code> helper function</h4>
<p>The helper function <code>plot_dendrogram</code> provides a one-line way to create a dendrogram plot. The first required argument is either the result of a <code>linkage</code> function as input (a numpy array), or a standardized data matrix. The default is to have the linkage result. If a standardized data matrix is the input, then the argument <code>package</code> must be set to <code>"scikit"</code> (the default is <code>"scipy"</code>, for a linkage result). The second required argument is the number of clusters, <code>n_clusters</code>.</p>
<p>Other arguments include <code>labels</code> (default <code>None</code>) for any labels other than sequence numbers to be assigned to the leaves of the graph, a linkage method (default <code>"ward"</code>, only required when a standardized array is passed, otherwise ignored), and a couple of customizations of the plot. These consist of <code>figsize</code> (default <code>(12,7)</code>), and <code>title</code> (default “Dendrogram”).</p>
<p>Note that this function only works well for smallish data sets. Large data sets require further customization, which is currently not implemented.</p>
<p>In the example given, we pass <code>X</code>, keep the number of clusters to <code>n_clusters</code>, set the <code>package = "scikit"</code>, use the <code>community</code> variable from the data frame as the labels, and customize the title to <code>"Ward Dendrogram"</code>. The result dictionary is passed to <code>R2</code>, which is then used to summarize the cluster labels. The dendrogram is identical to the one above, except that now the community area names are used as labels for the observations.</p>
<div id="cell-fig-dendrogram-helper" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>R2 <span class="op">=</span> plot_dendrogram(X, n_clusters <span class="op">=</span> n_clusters, package <span class="op">=</span> <span class="st">"scikit"</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                labels <span class="op">=</span> dfs[<span class="st">'community'</span>].values, </span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                title <span class="op">=</span> <span class="st">"Ward Dendrogram"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-dendrogram-helper" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-dendrogram-helper-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_clustering_files/figure-html/fig-dendrogram-helper-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-dendrogram-helper-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.2: Dendrogram graph obtained from helper function
</figcaption>
</figure>
</div>
</div>
</div>
<p>We obtain the same cluster statistics as before with <code>cluster_stats</code>, but now pass <code>R2["leaves_color_list"]</code> from the result dictionary (<code>R2</code>).</p>
<div id="b2f74d10" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>c_stats <span class="op">=</span> cluster_stats(R2[<span class="st">"leaves_color_list"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Labels Cardinality
    C1          13
    C2          15
    C3          15
    C4          13
    C5          21</code></pre>
</div>
</div>
</section>
</section>
<section id="cluster-centers" class="level3" data-number="7.2.3">
<h3 data-number="7.2.3" class="anchored" data-anchor-id="cluster-centers"><span class="header-section-number">7.2.3</span> Cluster Centers</h3>
<p>A useful property of each cluster is its <em>center</em>, i.e., the mean or median of the variables for those observations included in the cluster.</p>
<p>We accomplish this by means of a <code>groupby</code> computation on the cluster labels. These are first added to the data frame with the original observations (not the standardized values). The resulting centers can be visualized in a number of different ways, for example in a parallel coordinate plot or as a conditional box plot. This is not further pursued here.</p>
<div id="5c2bda9c" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>dt_clust <span class="op">=</span> data_cluster.copy().assign(cluster <span class="op">=</span> cluster_labels)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>clust_means <span class="op">=</span> dt_clust.groupby(<span class="st">'cluster'</span>).mean()</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>clust_medians <span class="op">=</span> dt_clust.groupby(<span class="st">'cluster'</span>).median()</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Cluster Means:</span><span class="ch">\n</span><span class="st">"</span>, np.<span class="bu">round</span>(clust_means, <span class="dv">2</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Cluster Medians:</span><span class="ch">\n</span><span class="st">"</span>, np.<span class="bu">round</span>(clust_medians, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster Means:
          INCPERCAP  Und20   Ov65  Minrty  Unemprt  Noveh  Lt_high  Rentocc  \
cluster                                                                      
0         34837.81  24.17  14.66   50.99     5.46   5.66    13.66    33.37   
1         22405.93  23.39  19.44   94.75    16.61  13.73    16.41    40.44   
2         62399.07  16.61  10.79   42.53     4.29  18.05     5.73    54.33   
3         18938.69  30.29  10.61   89.55    10.88   6.69    30.92    41.98   
4         19440.38  29.99  11.92   96.43    18.75  22.93    16.20    62.47   

         Rntburd  Noeng  
cluster                  
0          19.05  45.71  
1          28.29  12.52  
2          21.55  25.26  
3          25.13  73.03  
4          38.88   7.23  

Cluster Medians:
          INCPERCAP  Und20   Ov65  Minrty  Unemprt  Noveh  Lt_high  Rentocc  \
cluster                                                                      
0          31267.0  23.60  15.63   57.22     5.21   5.80    14.69    30.76   
1          21723.0  24.65  18.23   98.39    16.13  11.99    15.41    41.20   
2          57167.0  17.34   9.62   43.40     4.02  19.41     5.77    56.28   
3          19446.0  30.50  10.43   87.37    11.35   6.12    29.41    44.43   
4          18641.0  29.41  11.94   97.45    17.07  22.14    13.45    61.76   

         Rntburd  Noeng  
cluster                  
0          19.55  49.63  
1          27.92   7.29  
2          21.52  24.57  
3          24.81  77.56  
4          38.31   5.06  </code></pre>
</div>
</div>
<p>The helper function <code>cluster_center</code> computes the cluster means and medians in a single command. The required arguments are a data frame with the variables used in the clustering exercise and an array of cluster labels. The function returns a tuple with data frames of the means and medians.</p>
<p>To illustrate this, we pass the <code>data_cluster</code> data frame and the <code>R2["leaves_color_list"]</code> set of labels, and print out the means.</p>
<div id="4bf2f407" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>c_means,c_medians <span class="op">=</span> cluster_center(data_cluster, R2[<span class="st">"leaves_color_list"</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Cluster Means:</span><span class="ch">\n</span><span class="st">"</span>, np.<span class="bu">round</span>(c_means, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster Means:
          INCPERCAP  Und20   Ov65  Minrty  Unemprt  Noveh  Lt_high  Rentocc  \
cluster                                                                      
C1        32349.54  24.53  14.64   70.26    11.19  18.16    10.97    55.98   
C2        29496.73  25.42  11.35   69.98     7.73   9.53    19.70    47.75   
C3        40604.53  20.07  14.86   72.58     9.56  17.65    15.36    50.04   
C4        30449.69  26.57  13.76   77.16    12.43  10.43    16.15    38.07   
C5        30223.24  25.93  13.90   71.09    11.75   9.57    16.82    37.65   

         Rntburd  Noeng  
cluster                  
C1         28.84  23.32  
C2         26.47  46.41  
C3         26.31  28.09  
C4         23.28  31.36  
C5         24.31  35.32  </code></pre>
</div>
</div>
</section>
<section id="cluster-fit" class="level3" data-number="7.2.4">
<h3 data-number="7.2.4" class="anchored" data-anchor-id="cluster-fit"><span class="header-section-number">7.2.4</span> Cluster Fit</h3>
<p>The main objective of a clustering exercise is to decompose the total sum of squared differences from the mean (TSS) into a within cluster (WSS) and between cluster (BSS) part. The more similar the members of a cluster are, the smaller WSS will be. As a consequence, BSS will be larger, since the two are complements: TSS = WSS + BSS. The higher the ratio of BSS to WSS, the <em>better</em> the fit.</p>
<p>Since we typically standardize the variables before the clustering exercise, the mean is zero and the variance for each variable equals 1, hence the TSS will equal <span class="math inline">\(p \times n\)</span>, where <span class="math inline">\(p\)</span> is the number of variables and <span class="math inline">\(n\)</span> is the number of observations. In our example, this would be 770. This is a direct result of how <code>StandardScaler</code> carries out the standardization, i.e., it uses n as the denominator in the computation of the variance/standard deviation. In contrast, <code>GeoDa</code> uses <span class="math inline">\(n-1\)</span> as the denominator (for an <em>unbiased</em> estimate). As a result, <code>GeoDa</code> will report 760 as the TSS. We address this in our helper function (<code>cluster_fit</code>), by rescaling <code>X</code> with <span class="math inline">\(\sqrt{(n-1)/n}\)</span>.</p>
<p>First, we illustrate the steps using the <code>StandardScaler</code> approach. Note that the ratio BSS/TSS is not affected by the choice of the standardization, but the individual WSS and the TSS measures are.</p>
<p>In order to compute the WSS by cluster, we need to compute the cluster means. In contrast to what we just carried out, now the calculation must be done for the standardized variables, but otherwise the approach is the same, using <code>groupby</code> for the cluster labels. In each cluster, the WSS is the sum of squared deviations from the mean. The sum of all the cluster-specific WSS is the total WSS. The BSS is obtained as TSS - WSS. The final ratio is BSS/TSS.</p>
<p>First, the TSS.</p>
<div id="5302a0e2" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>tss <span class="op">=</span> np.<span class="bu">sum</span>(np.square(X))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"TSS:"</span>, tss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>TSS: 770.0</code></pre>
</div>
</div>
<p>We compute the WSS for each cluster by first calculating the cluster mean using the same <code>groupby</code> approach as above, but now applied to the standardized variables. We then square the difference between each cluster member observation and the mean and sum the result.</p>
<div id="a147c882" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>data_tmp <span class="op">=</span> data_cluster.copy().assign(cluster <span class="op">=</span> cluster_labels)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>wss_per_cluster <span class="op">=</span> []</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cluster <span class="kw">in</span> <span class="bu">set</span>(cluster_labels):</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    cluster_data <span class="op">=</span> X[data_tmp[<span class="st">'cluster'</span>] <span class="op">==</span> cluster]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    cluster_mean <span class="op">=</span> cluster_data.mean(axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    wss <span class="op">=</span> np.<span class="bu">sum</span>(np.square(cluster_data <span class="op">-</span> cluster_mean))</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    wss_per_cluster.append(wss)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>wss_per_cluster <span class="op">=</span> [<span class="bu">float</span>(wss) <span class="cf">for</span> wss <span class="kw">in</span> wss_per_cluster]</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Cluster WSS:</span><span class="ch">\n</span><span class="st">"</span>, np.<span class="bu">round</span>(wss_per_cluster, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster WSS:
 [81.496 68.007 57.317 22.29  44.942]</code></pre>
</div>
</div>
<p>The total WSS is simply the sum of the cluster-specific WSS.</p>
<div id="2368fb8c" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>wss <span class="op">=</span> np.<span class="bu">sum</span>(wss_per_cluster)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"WSS:"</span>, np.<span class="bu">round</span>(wss, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WSS: 274.052</code></pre>
</div>
</div>
<p>Finally, the BSS is the complement of WSS, or TSS - WSS and the ratio BSS/TSS can be computed.</p>
<div id="13b4748f" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>bss <span class="op">=</span> tss <span class="op">-</span> wss</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>btratio <span class="op">=</span> bss<span class="op">/</span>tss</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"BSS:"</span>, np.<span class="bu">round</span>(bss, <span class="dv">3</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">BSS/TSS:"</span>, np.<span class="bu">round</span>(btratio, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>BSS: 495.948 
BSS/TSS: 0.644</code></pre>
</div>
</div>
<p>The helper function <code>cluster_fit</code> carries out these calculations and returns them as a dictionary, optionally listing the result. Its required arguments are <code>data</code> for the original cluster variable observations, <code>clustlabels</code> for the cluster labels (to carry out the <code>groupby</code>), and <code>n_clusters</code>, the number of clusters. Optional arguments are <code>correct</code> (default is <code>False</code>) and <code>printopt</code> (default is <code>True</code>). Computing the standardized values with n-1 as the denominator is achieved by setting <code>correct = True</code>, and avoiding a listing of the results is set with <code>printopt = False</code>.</p>
<p>We first illustrate this for the standard options. The results are identical to those shown above.</p>
<div id="b4a66b06" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>clusfit <span class="op">=</span> cluster_fit(data <span class="op">=</span> data_cluster, clustlabels <span class="op">=</span> cluster_labels,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                 n_clusters <span class="op">=</span> n_clusters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Total Sum of Squares (TSS): 770.0
Within-cluster Sum of Squares (WSS) for each cluster: [81.496 68.007 57.317 22.29  44.942]
Total Within-cluster Sum of Squares (WSS): 274.052
Between-cluster Sum of Squares (BSS): 495.948
Ratio of BSS to TSS: 0.644</code></pre>
</div>
</div>
<p>With <code>correct = True</code>, the standardization is different. The results now replicate those given by <code>GeoDa</code>. Note how the BSS/TSS ratio is unaffected.</p>
<div id="be4e1df3" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>clusfit <span class="op">=</span> cluster_fit(data <span class="op">=</span> data_cluster, clustlabels <span class="op">=</span> cluster_labels,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                 n_clusters <span class="op">=</span> n_clusters, correct <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Total Sum of Squares (TSS): 760.0
Within-cluster Sum of Squares (WSS) for each cluster: [80.437 67.124 56.572 22.    44.358]
Total Within-cluster Sum of Squares (WSS): 270.493
Between-cluster Sum of Squares (BSS): 489.507
Ratio of BSS to TSS: 0.644</code></pre>
</div>
</div>
</section>
<section id="cluster-map" class="level3" data-number="7.2.5">
<h3 data-number="7.2.5" class="anchored" data-anchor-id="cluster-map"><span class="header-section-number">7.2.5</span> Cluster Map</h3>
<p>A final summary of the cluster results is a cluster map, a simple categorical thematic map that highlights the membership of clusters.</p>
<p>The cluster map is implemented in the helper function <code>cluster_map</code>, with some very simple defaults. It takes as required arguments the GeoDataFrame and the cluster labels. Other arguments are <code>figsize</code> (default <code>(5,5)</code>), <code>title</code> (default <code>"Clusters"</code>), and <code>cmap</code> for the color map (default <code>"Set2"</code>).</p>
<p>In our example:</p>
<div id="cell-fig-hierarchical-clustermap" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cluster_map(dfs, cluster_labels, figsize <span class="op">=</span> (<span class="dv">5</span>,<span class="dv">5</span>), </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>            title<span class="op">=</span><span class="st">""</span>, cmap<span class="op">=</span><span class="st">'Set2'</span>, legend_fontsize<span class="op">=</span><span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-hierarchical-clustermap" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hierarchical-clustermap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_clustering_files/figure-html/fig-hierarchical-clustermap-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hierarchical-clustermap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.3: Cluster map for Ward linkage clustering
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="other-linkage-functions" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="other-linkage-functions"><span class="header-section-number">7.3</span> Other Linkage Functions</h2>
<p>The other linkage functions are invoked with methods <code>"single"</code>, <code>"complete"</code> and <code>"average"</code>. Rather than completing the same commands each time, we create a loop over the linkage functions and use our helper functions to list the cluster results, centers, measures of fit and the cluster map.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>clustmethods <span class="op">=</span> [<span class="st">'single'</span>, <span class="st">'complete'</span>, <span class="st">'average'</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> cl <span class="kw">in</span> clustmethods:</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    clust <span class="op">=</span> AgglomerativeClustering(n_clusters <span class="op">=</span> n_clusters, </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                    linkage <span class="op">=</span> cl, compute_distances <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    clust.fit(X)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    cluster_labels <span class="op">=</span> clust.labels_</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"---------------------------------</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Clusters"</span>, cl, <span class="st">"linkage"</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    c_stats <span class="op">=</span> cluster_stats(cluster_labels)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>    plot_dendrogram(X, n_clusters <span class="op">=</span> n_clusters, package <span class="op">=</span> <span class="st">"scikit"</span>,</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>                    method <span class="op">=</span> cl,labels <span class="op">=</span> dfs[<span class="st">'community'</span>].values)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    c_means,c_medians <span class="op">=</span> cluster_center(data_cluster, cluster_labels)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cluster Means:</span><span class="ch">\n</span><span class="st">"</span>, np.<span class="bu">round</span>(c_means, <span class="dv">2</span>))</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Cluster Medians:</span><span class="ch">\n</span><span class="st">"</span>, np.<span class="bu">round</span>(c_medians, <span class="dv">2</span>))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    clusfit <span class="op">=</span> cluster_fit(data <span class="op">=</span> data_cluster, clustlabels <span class="op">=</span> cluster_labels,</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>                 n_clusters <span class="op">=</span> n_clusters)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    cluster_map(dfs, cluster_labels, title<span class="op">=</span><span class="st">""</span>, cmap<span class="op">=</span><span class="st">'Set2'</span>, legend_fontsize<span class="op">=</span><span class="dv">8</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>---------------------------------

Clusters single linkage
 Labels  Cardinality
      0           73
      1            1
      2            1
      3            1
      4            1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster Means:
          INCPERCAP  Und20   Ov65  Minrty  Unemprt  Noveh  Lt_high  Rentocc  \
cluster                                                                      
0         33320.42  24.59  13.31   70.78    10.01  12.04    15.64    44.51   
1         19972.00  13.31  26.52   99.50    20.14  16.95    15.41    36.60   
2         11857.00  44.28   4.80   98.79    30.42  30.33    15.69    76.92   
3         16519.00  19.88  26.44   96.37    23.62  34.31    21.40    56.20   
4         21858.00  18.54  24.82   86.05     8.21  19.92    37.18    61.19   

         Rntburd  Noeng  
cluster                  
0          25.49  34.05  
1          29.95   4.41  
2          30.71   3.09  
3          31.26   7.38  
4          27.29  69.47  
Cluster Medians:
          INCPERCAP  Und20   Ov65  Minrty  Unemprt  Noveh  Lt_high  Rentocc  \
cluster                                                                      
0          26943.0  25.14  12.73   82.70     8.34  10.01    14.41    48.32   
1          19972.0  13.31  26.52   99.50    20.14  16.95    15.41    36.60   
2          11857.0  44.28   4.80   98.79    30.42  30.33    15.69    76.92   
3          16519.0  19.88  26.44   96.37    23.62  34.31    21.40    56.20   
4          21858.0  18.54  24.82   86.05     8.21  19.92    37.18    61.19   

         Rntburd  Noeng  
cluster                  
0          23.62  28.02  
1          29.95   4.41  
2          30.71   3.09  
3          31.26   7.38  
4          27.29  69.47  

Total Sum of Squares (TSS): 770.0
Within-cluster Sum of Squares (WSS) for each cluster: [677.299   0.      0.      0.      0.   ]
Total Within-cluster Sum of Squares (WSS): 677.299
Between-cluster Sum of Squares (BSS): 92.701
Ratio of BSS to TSS: 0.12</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>---------------------------------

Clusters complete linkage
 Labels  Cardinality
      0           21
      1           29
      2            3
      3           10
      4           14</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster Means:
          INCPERCAP  Und20   Ov65  Minrty  Unemprt  Noveh  Lt_high  Rentocc  \
cluster                                                                      
0         19837.71  28.62  13.65   96.50    18.62  19.02    16.47    54.96   
1         35389.38  22.82  15.51   56.44     6.54   8.46    11.63    36.30   
2         19449.67  17.24  25.93   93.97    17.32  23.73    24.67    51.33   
3         72820.90  16.13   9.23   35.95     3.33  16.38     4.45    51.17   
4         19511.07  29.66  10.55   88.80    10.52   7.20    30.73    43.41   

         Rntburd  Noeng  
cluster                  
0          35.69   8.86  
1          20.52  36.37  
2          29.50  27.09  
3          19.69  23.27  
4          24.97  72.51  
Cluster Medians:
          INCPERCAP  Und20   Ov65  Minrty  Unemprt  Noveh  Lt_high  Rentocc  \
cluster                                                                      
0          19493.0  26.77  14.36   97.45    17.07  20.12    15.69    53.08   
1          31866.0  22.95  15.71   57.22     5.39   6.05    10.82    31.36   
2          19972.0  18.54  26.44   96.37    20.14  19.92    21.40    56.20   
3          73295.0  15.91   8.75   35.95     2.89  15.92     4.24    54.05   
4          19699.0  30.39  10.31   87.36    10.42   6.16    29.23    45.87   

         Rntburd  Noeng  
cluster                  
0          34.59   6.04  
1          21.07  37.18  
2          29.95   7.38  
3          19.38  23.52  
4          24.37  76.95  

Total Sum of Squares (TSS): 770.0
Within-cluster Sum of Squares (WSS) for each cluster: [ 86.209 149.571  14.489  29.811  27.436]
Total Within-cluster Sum of Squares (WSS): 307.515
Between-cluster Sum of Squares (BSS): 462.485
Ratio of BSS to TSS: 0.601</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>---------------------------------

Clusters average linkage
 Labels  Cardinality
      0           18
      1           30
      2           27
      3            1
      4            1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster Means:
          INCPERCAP  Und20   Ov65  Minrty  Unemprt  Noveh  Lt_high  Rentocc  \
cluster                                                                      
0         60754.28  18.41  11.65   36.84     3.74  14.52     5.42    45.22   
1         25780.70  26.63  12.71   70.96     8.09   6.53    22.38    39.64   
2         22292.00  25.85  16.07   95.23    17.21  17.52    15.17    49.59   
3         21858.00  18.54  24.82   86.05     8.21  19.92    37.18    61.19   
4         11857.00  44.28   4.80   98.79    30.42  30.33    15.69    76.92   

         Rntburd  Noeng  
cluster                  
0          19.30  23.58  
1          22.54  61.68  
2          33.26   8.24  
3          27.29  69.47  
4          30.71   3.09  
Cluster Medians:
          INCPERCAP  Und20   Ov65  Minrty  Unemprt  Noveh  Lt_high  Rentocc  \
cluster                                                                      
0          55224.5  18.07  10.34   37.36     3.73  15.92     4.63    54.05   
1          26443.5  26.32  11.92   73.81     7.19   6.04    19.62    42.87   
2          20439.0  25.46  15.64   97.45    16.17  18.84    14.41    50.28   
3          21858.0  18.54  24.82   86.05     8.21  19.92    37.18    61.19   
4          11857.0  44.28   4.80   98.79    30.42  30.33    15.69    76.92   

         Rntburd  Noeng  
cluster                  
0          19.38  24.43  
1          21.91  58.43  
2          30.28   5.11  
3          27.29  69.47  
4          30.71   3.09  

Total Sum of Squares (TSS): 770.0
Within-cluster Sum of Squares (WSS) for each cluster: [103.805 124.272 139.236   0.      0.   ]
Total Within-cluster Sum of Squares (WSS): 367.312
Between-cluster Sum of Squares (BSS): 402.688
Ratio of BSS to TSS: 0.523</code></pre>
</div>
<div id="fig-other-hierarchical" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="22">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-other-hierarchical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output cell-output-display">
<div id="fig-other-hierarchical-1" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-other-hierarchical-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_clustering_files/figure-html/fig-other-hierarchical-output-2.png" class="img-fluid figure-img" data-ref-parent="fig-other-hierarchical">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-other-hierarchical-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Dendrogram - Single Linkage
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-other-hierarchical-2" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-other-hierarchical-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_clustering_files/figure-html/fig-other-hierarchical-output-4.png" class="img-fluid figure-img" data-ref-parent="fig-other-hierarchical">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-other-hierarchical-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Cluster Map - Single Linkage
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-other-hierarchical-3" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-other-hierarchical-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_clustering_files/figure-html/fig-other-hierarchical-output-6.png" class="img-fluid figure-img" data-ref-parent="fig-other-hierarchical">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-other-hierarchical-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Dendrogram - Complete Linkage
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-other-hierarchical-4" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-other-hierarchical-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_clustering_files/figure-html/fig-other-hierarchical-output-8.png" class="img-fluid figure-img" data-ref-parent="fig-other-hierarchical">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-other-hierarchical-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(d) Cluster Map - Complete Linkage
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-other-hierarchical-5" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-other-hierarchical-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_clustering_files/figure-html/fig-other-hierarchical-output-10.png" class="img-fluid figure-img" data-ref-parent="fig-other-hierarchical">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-other-hierarchical-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(e) Dendrogram - Average Linkage
</figcaption>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div id="fig-other-hierarchical-6" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-subfloat-fig figure">
<div aria-describedby="fig-other-hierarchical-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="hierarchical_clustering_files/figure-html/fig-other-hierarchical-output-12.png" class="img-fluid figure-img" data-ref-parent="fig-other-hierarchical">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-other-hierarchical-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(f) Cluster Map - Average Linkage
</figcaption>
</figure>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-other-hierarchical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7.4: Other hierarchical clustering solutions
</figcaption>
</figure>
</div>
</div>
<p>The results highlight the superiority of Ward’s method, with only Complete Linkage coming close with a BSS/TSS ratio of 0.60 (compared to 0.64 for Ward’s method). Single linkage typically results in one or two very large clusters and several singletons. Average linkage is somewhere in-between.</p>
</section>
<section id="practice" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="practice"><span class="header-section-number">7.4</span> Practice</h2>
<p>Select a different subset of variables or use your own data set to carry out an in-depth comparison of the results of the four different linkage methods. Assess how the findings change with a different cut point.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Kolaketal20" class="csl-entry" role="listitem">
Kolak, Marynia, Jay Bhatt, Yoon Hong Park, Norma A. Padrón, and Ayrin Molefe. 2020. <span>“Quantification of Neighborhood-Level Social Determinants of Health in the Continental United States.”</span> <em>JAMA Network Open</em> 3 (1): e1919928–28. <a href="https://doi.org/10.1001/jamanetworkopen.2019.19928">https://doi.org/10.1001/jamanetworkopen.2019.19928</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./MDS.html" class="pagination-link" aria-label="Distance Preserving Methods">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Distance Preserving Methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./kmeans.html" class="pagination-link" aria-label="Partitioning Clustering Methods">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Partitioning Clustering Methods</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Copyright 2025 GeoDa Press LLC, All Rights Reserved</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>